<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go BARRY - Bus Alerts and Roadworks Reporting for You</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e16;
            --bg-secondary: #111827;
            --bg-card: rgba(17, 24, 39, 0.95);
            --bg-glass: rgba(255, 255, 255, 0.05);
            --border-glass: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #e2e8f0;
            --text-muted: #94a3b8;
            --text-bright: #f8fafc;
            --accent-blue: #3b82f6;
            --accent-cyan: #06b6d4;
            --accent-purple: #8b5cf6;
            --accent-emerald: #10b981;
            --status-critical: #ef4444;
            --status-warning: #f59e0b;
            --status-success: #10b981;
            --status-info: #3b82f6;
            --shadow-glow: 0 0 30px rgba(59, 130, 246, 0.1);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.3);
            --primary-blue: #007AFF;
            --primary-light: #60A5FA;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #1a202c 100%);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            font-size: 14px;
            position: relative;
        }

        /* Enhanced animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 60% 70%, rgba(16, 185, 129, 0.08) 0%, transparent 50%);
            animation: float 30s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
            25% { transform: translateY(-10px) rotate(45deg); opacity: 1; }
            50% { transform: translateY(-20px) rotate(90deg); opacity: 0.8; }
            75% { transform: translateY(-10px) rotate(135deg); opacity: 1; }
        }

        /* Header with logo and navigation */
        .header {
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-glass);
            padding: 16px 32px;
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 24px;
            align-items: center;
            box-shadow: var(--shadow-card);
            position: relative;
            z-index: 100;
        }

        .header::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan), var(--accent-purple), var(--accent-emerald));
            animation: rainbow-flow 5s ease-in-out infinite;
        }

        @keyframes rainbow-flow {
            0%, 100% { opacity: 0.7; transform: translateX(-20%); }
            50% { opacity: 1; transform: translateX(20%); }
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 800;
            color: var(--text-bright);
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .logo-image {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: contain;
            filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.5));
        }

        /* Navigation tabs */
        .nav-tabs {
            display: flex;
            gap: 8px;
            background: var(--bg-glass);
            padding: 8px;
            border-radius: 12px;
            border: 1px solid var(--border-glass);
        }

        .nav-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 8px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
        }

        .nav-tab.active {
            background: var(--accent-blue);
            color: var(--text-bright);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .nav-tab i {
            font-size: 16px;
        }

        /* Duty & Supervisor Section */
        .duty-supervisor-section {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        }

        .duty-info {
            background: var(--bg-glass);
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-glass);
            text-align: right;
        }

        .duty-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 2px;
        }

        .duty-name {
            font-size: 13px;
            color: var(--accent-cyan);
            font-weight: 600;
        }

        .supervisor-section {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-glass);
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-glass);
        }

        .supervisor-info {
            text-align: right;
        }

        .supervisor-name {
            font-size: 13px;
            color: var(--status-success);
            font-weight: 600;
        }

        .supervisor-role {
            font-size: 11px;
            color: var(--text-muted);
        }

        .login-button, .logout-button, .change-duty-btn {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .login-button:hover, .logout-button:hover, .change-duty-btn:hover {
            background: var(--accent-cyan);
            transform: translateY(-1px);
        }

        .logout-button {
            background: var(--status-warning);
        }

        .change-duty-btn {
            background: var(--accent-purple);
            font-size: 11px;
            padding: 6px 12px;
        }

        /* Clock section */
        .clock-section {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .clock {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-bright);
            letter-spacing: 1px;
            font-variant-numeric: tabular-nums;
            text-shadow: 0 0 15px rgba(248, 250, 252, 0.6);
        }

        .last-update {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Main content area */
        .main-content {
            height: calc(100vh - 120px);
            padding: 20px 32px;
            overflow-y: auto;
            position: relative;
        }

        /* Tab content panels */
        .tab-content {
            display: none;
            height: 100%;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Layout */
        .dashboard-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            grid-template-rows: 180px 1fr;
            gap: 20px;
            height: 100%;
        }

        .analytics-strip {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
        }

        .analytics-card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-card);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .analytics-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));
            opacity: 0.8;
        }

        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .chart-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--accent-blue);
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
            font-variant-numeric: tabular-nums;
        }

        .chart-subtitle {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Alerts section */
        .alerts-section {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow-card);
            overflow: hidden;
            position: relative;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-glass);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .alert-count {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            color: var(--text-bright);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .alerts-container {
            height: calc(100% - 80px);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Alert cards */
        .alert-card {
            background: rgba(24, 35, 54, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 32px;
            margin-bottom: 24px;
            border-left: 6px solid var(--status-critical);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .alert-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(255,255,255,0.1) 10%, rgba(255,255,255,0.02) 80%);
            pointer-events: none;
            z-index: 1;
        }

        .alert-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            z-index: 2;
            position: relative;
        }

        .alert-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--text-bright);
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
            flex: 1;
            margin-bottom: 12px;
        }

        .alert-location {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .alert-actions {
            display: flex;
            gap: 12px;
            z-index: 2;
            position: relative;
        }

        .dismiss-button, .acknowledge-button, .map-button {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .map-button {
            background: rgba(59, 130, 246, 0.8);
            color: white;
        }

        .dismiss-button {
            background: rgba(239, 68, 68, 0.8);
            color: white;
        }

        .acknowledge-button {
            background: rgba(16, 185, 129, 0.8);
            color: white;
        }

        .dismiss-button:hover, .acknowledge-button:hover, .map-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .map-button:hover {
            background: rgba(59, 130, 246, 1);
        }

        .dismiss-button:disabled {
            background: rgba(107, 114, 128, 0.5);
            cursor: not-allowed;
            transform: none;
        }

        .route-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .route-badge {
            background: var(--accent-blue);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .alert-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-emerald));
            opacity: 0.7;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .card-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Alerts tab layout */
        .alerts-layout {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 20px;
        }

        .alerts-controls {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-card);
        }

        .controls-row {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 16px;
        }

        .search-input {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-glass);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 8px;
            padding: 8px 16px;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--accent-blue);
            color: var(--text-bright);
        }

        .alerts-grid {
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            padding-right: 8px;
        }

        /* Maps layout */
        .maps-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            height: 100%;
            gap: 20px;
        }

        .map-controls {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-card);
        }

        .map-container {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-card);
            position: relative;
            overflow: hidden;
        }

        .map-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e293b, #334155);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: var(--text-muted);
        }

        /* Loading states */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
            color: var(--text-muted);
            gap: 16px;
            flex-direction: column;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-alerts {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .no-alerts i {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--status-success);
            animation: success-pulse 3s ease-in-out infinite;
        }

        @keyframes success-pulse {
            0%, 100% { 
                transform: scale(1);
                filter: drop-shadow(0 0 15px rgba(16, 185, 129, 0.4));
            }
            50% { 
                transform: scale(1.05);
                filter: drop-shadow(0 0 25px rgba(16, 185, 129, 0.6));
            }
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1e293b, #334155);
            margin: 8% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 1px solid var(--border-glass);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            color: var(--text-bright);
            font-size: 20px;
            font-weight: 700;
        }

        .close-button {
            background: none;
            border: none;
            color: var(--text-bright);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .close-button:hover {
            background: rgba(255,255,255,0.1);
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
        }

        .form-select, .form-textarea, .form-input {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-glass);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-bright);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-select:focus, .form-textarea:focus, .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            background: rgba(255,255,255,0.15);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .duty-option {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-glass);
            border-radius: 8px;
            width: 100%;
            cursor: pointer;
            text-align: center;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .duty-option:hover, .duty-option.selected {
            background: var(--accent-blue);
            color: var(--text-bright);
            border-color: var(--accent-blue);
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .modal-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-button.cancel {
            background: rgba(107, 114, 128, 0.3);
            color: var(--text-secondary);
        }

        .modal-button.confirm {
            background: var(--accent-blue);
            color: white;
        }

        .modal-button:hover {
            transform: translateY(-1px);
        }

        /* System status indicators */
        .system-status {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border: 1px solid var(--border-glass);
        }

        .status-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .status-value {
            color: var(--text-bright);
            font-weight: 600;
            font-family: monospace;
        }

        .status-value.healthy {
            color: var(--status-success);
        }

        .status-value.warning {
            color: var(--status-warning);
        }

        .status-value.error {
            color: var(--status-critical);
        }

        /* Responsive adjustments */
        @media (max-width: 1400px) {
            .analytics-strip {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .dashboard-layout {
                grid-template-columns: 1fr 300px;
            }
        }

        @media (max-width: 1200px) {
            .header {
                grid-template-columns: auto 1fr auto;
                gap: 16px;
            }
            
            .duty-supervisor-section {
                display: none;
            }
            
            .analytics-strip {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }
            
            .dashboard-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            
            .sidebar {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo-section">
            <div class="logo">
                <img src="go-barry-logo.png" alt="Go BARRY" class="logo-image" onerror="this.style.display='none'">
                <span>Go BARRY</span>
            </div>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">
                <i class="fas fa-chart-bar"></i>
                <span>Dashboard</span>
            </button>
            <button class="nav-tab" onclick="switchTab('alerts')">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Alerts</span>
            </button>
            <button class="nav-tab" onclick="switchTab('maps')">
                <i class="fas fa-map"></i>
                <span>Maps</span>
            </button>
            <button class="nav-tab" onclick="switchTab('system')">
                <i class="fas fa-server"></i>
                <span>System</span>
            </button>
            <button class="nav-tab" onclick="switchTab('settings')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </div>

        <!-- Duty & Supervisor Section -->
        <div class="duty-supervisor-section">
            <div class="duty-info" id="duty-info" style="display: none;">
                <div class="duty-label">Current Duty:</div>
                <div class="duty-name" id="duty-name">-</div>
                <button class="change-duty-btn" onclick="showDutyModal()">Change</button>
            </div>
            
            <div class="supervisor-section">
                <div id="supervisor-login" class="supervisor-login" style="display: block;">
                    <button class="login-button" onclick="showLoginModal()">
                        <i class="fas fa-user-shield"></i>
                        <span>Supervisor Login</span>
                    </button>
                </div>
                <div id="supervisor-info" class="supervisor-info" style="display: none;">
                    <div class="supervisor-name" id="supervisor-name">Not Logged In</div>
                    <div class="supervisor-role" id="supervisor-role">-</div>
                </div>
                <div id="supervisor-actions" style="display: none;">
                    <button class="logout-button" onclick="logoutSupervisor()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Clock Section -->
        <div class="clock-section">
            <div class="clock" id="clock">--:--:--</div>
            <div class="last-update" id="last-update">Last Update: --:--</div>
        </div>
    </div>
    <div id="supervisor-indicator" style="position:fixed;top:14px;right:20px;z-index:1200;pointer-events:none;"></div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <div class="dashboard-layout">
                <div class="analytics-strip">
                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-exclamation-triangle" style="color: var(--status-critical);"></i>
                            Active Alerts
                        </div>
                        <div class="chart-value" id="active-alerts-count">0</div>
                        <div class="chart-subtitle">Critical incidents</div>
                    </div>

                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-clock" style="color: var(--status-warning);"></i>
                            Response Time
                        </div>
                        <div class="chart-value" id="avg-response-time">0 min</div>
                        <div class="chart-subtitle">Average today</div>
                    </div>

                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-route" style="color: var(--accent-cyan);"></i>
                            Affected Routes
                        </div>
                        <div class="chart-value" id="affected-routes-count">0</div>
                        <div class="chart-subtitle">Bus routes impacted</div>
                    </div>

                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-user-check" style="color: var(--accent-emerald);"></i>
                            Supervisor Actions
                        </div>
                        <div class="chart-value" id="supervisor-actions-count">0</div>
                        <div class="chart-subtitle">Today</div>
                    </div>

                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-check-circle" style="color: var(--status-success);"></i>
                            Resolved
                        </div>
                        <div class="chart-value" id="resolved-count">0</div>
                        <div class="chart-subtitle">Today</div>
                    </div>
                </div>

                <div class="alerts-section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-satellite-dish"></i>
                            <span>Live Traffic Intelligence</span>
                        </div>
                        <div class="alert-count" id="dashboard-alert-count">0</div>
                    </div>
                    <div class="alerts-container" id="dashboard-alerts-container">
                        <div class="loading">
                            <div class="spinner"></div>
                            <span>Loading traffic alerts...</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-user-shield"></i>
                            Supervisor Activity
                        </div>
                        <div id="supervisor-activity">
                            <p style="color: var(--text-muted); text-align: center; padding: 20px;">
                                Log in to view supervisor activity
                            </p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-users"></i>
                            Logged-In Supervisors
                        </div>
                        <div id="logged-supervisors">
                            <p style="color: var(--text-muted); text-align: center; padding: 20px;">No supervisors logged in</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Daily Statistics
                        </div>
                        <div id="daily-stats">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Total Alerts:</span>
                                <span id="stats-total">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Dismissed:</span>
                                <span id="stats-dismissed">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Active:</span>
                                <span id="stats-active">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Tab -->
        <div id="alerts-tab" class="tab-content">
            <div class="alerts-layout">
                <div class="alerts-controls">
                    <div class="controls-row">
                        <input type="text" class="search-input" id="alert-search" placeholder="Search alerts, locations, routes...">
                        <div class="filter-buttons">
                            <button class="filter-btn active" onclick="filterAlerts('all')">All</button>
                            <button class="filter-btn" onclick="filterAlerts('incident')">🚨 Incidents</button>
                            <button class="filter-btn" onclick="filterAlerts('congestion')">🚗 Traffic</button>
                            <button class="filter-btn" onclick="filterAlerts('roadwork')">🚧 Roadworks</button>
                        </div>
                    </div>
                </div>
                <div class="alerts-grid" id="alerts-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <span>Loading alerts...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Maps Tab -->
        <div id="maps-tab" class="tab-content">
            <div class="maps-layout">
                <div class="map-controls">
                    <div class="card-title">
                        <i class="fas fa-map-marked-alt"></i>
                        Map Controls
                    </div>
                    <div style="margin-bottom: 16px;">
                        <button class="filter-btn active" onclick="filterMapAlerts('all')">All Alerts</button>
                        <button class="filter-btn" onclick="filterMapAlerts('incident')">Incidents</button>
                        <button class="filter-btn" onclick="filterMapAlerts('congestion')">Traffic</button>
                        <button class="filter-btn" onclick="filterMapAlerts('roadwork')">Roadworks</button>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <button class="modal-button confirm" onclick="centerMap()">
                            <i class="fas fa-crosshairs"></i> Center Map
                        </button>
                    </div>
                    <div class="system-status">
                        <div class="status-item">
                            <span class="status-label">Map Status:</span>
                            <span class="status-value healthy">Active</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Coverage:</span>
                            <span class="status-value">North East</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Markers:</span>
                            <span class="status-value" id="map-markers-count">0</span>
                        </div>
                    </div>
                </div>
                <div class="map-container">
                    <div class="map-placeholder">
                        <i class="fas fa-map" style="font-size: 48px; margin-bottom: 16px; color: var(--accent-blue);"></i>
                        <h3>Interactive Traffic Map</h3>
                        <p>Real-time traffic alerts across North East England</p>
                        <p style="margin-top: 12px; font-size: 12px; opacity: 0.7;">Map integration available in full deployment</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Tab -->
        <div id="system-tab" class="tab-content">
            <div class="dashboard-layout">
                <div class="analytics-strip">
                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-server" style="color: var(--status-success);"></i>
                            Backend Status
                        </div>
                        <div class="chart-value" id="backend-status">Healthy</div>
                        <div class="chart-subtitle">API operational</div>
                    </div>

                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-database" style="color: var(--accent-cyan);"></i>
                            Cached Alerts
                        </div>
                        <div class="chart-value" id="cached-alerts-count">0</div>
                        <div class="chart-subtitle">In memory</div>
                    </div>

                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-wifi" style="color: var(--accent-blue);"></i>
                            Connection
                        </div>
                        <div class="chart-value" id="connection-status">Connected</div>
                        <div class="chart-subtitle">API response</div>
                    </div>

                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-clock" style="color: var(--accent-purple);"></i>
                            Uptime
                        </div>
                        <div class="chart-value" id="system-uptime">99.9%</div>
                        <div class="chart-subtitle">Last 24h</div>
                    </div>

                    <div class="analytics-card">
                        <div class="chart-title">
                            <i class="fas fa-tachometer-alt" style="color: var(--accent-emerald);"></i>
                            Performance
                        </div>
                        <div class="chart-value" id="api-response-time">--ms</div>
                        <div class="chart-subtitle">API response</div>
                    </div>
                </div>

                <div class="alerts-section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-tools"></i>
                            <span>System Information</span>
                        </div>
                    </div>
                    <div class="system-status">
                        <div class="status-item">
                            <span class="status-label">Backend URL:</span>
                            <span class="status-value" id="backend-url">-</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">App Version:</span>
                            <span class="status-value">v2.1.0 Browser</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Environment:</span>
                            <span class="status-value">Production</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Coverage Area:</span>
                            <span class="status-value">North East England</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Last Refresh:</span>
                            <span class="status-value" id="last-refresh-time">-</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-play-circle"></i>
                            Quick Actions
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <button class="modal-button confirm" onclick="refreshData()">
                                <i class="fas fa-sync"></i> Refresh Data
                            </button>
                            <button class="modal-button" onclick="testAPI()" style="background: var(--accent-purple);">
                                <i class="fas fa-vial"></i> Test API
                            </button>
                            <button class="modal-button" onclick="clearCache()" style="background: var(--status-warning);">
                                <i class="fas fa-trash"></i> Clear Cache
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-history"></i>
                            Recent Activity
                        </div>
                        <div id="system-activity">
                            <div style="font-size: 12px; color: var(--text-muted); text-align: center; padding: 20px;">
                                System activity will appear here
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="dashboard-layout">
                <div class="alerts-section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-cog"></i>
                            <span>Application Settings</span>
                        </div>
                    </div>
                    <div class="system-status">
                        <div class="status-item">
                            <span class="status-label">Auto Refresh:</span>
                            <span class="status-value">Enabled (30s)</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Alert Cycling:</span>
                            <span class="status-value">Enabled (15s)</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Sound Notifications:</span>
                            <span class="status-value">Disabled</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Theme:</span>
                            <span class="status-value">Dark Professional</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-info-circle"></i>
                            About Go BARRY
                        </div>
                        <div style="font-size: 14px; line-height: 1.5; color: var(--text-secondary);">
                            <p><strong>Bus Alerts and Roadworks Reporting for You</strong></p>
                            <p>Professional traffic management system for North East England bus operations.</p>
                            <div style="margin: 16px 0; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <div style="font-size: 12px; margin-bottom: 4px;">Version: 2.1.0 Browser</div>
                                <div style="font-size: 12px; margin-bottom: 4px;">Build: 2025.06.04</div>
                                <div style="font-size: 12px;">Platform: Web Browser</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-shield-alt"></i>
                            Security & Privacy
                        </div>
                        <div style="font-size: 13px; color: var(--text-muted);">
                            <p>All traffic data is processed securely. Supervisor sessions are encrypted and logged for accountability.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Duty Selection Modal -->
    <div id="dutyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Select Your Duty</h2>
                <button class="close-button" onclick="closeDutyModal()">&times;</button>
            </div>
            <div class="modal-form">
                <div class="duty-option" onclick="selectDuty('100', 'Duty 100 (6am-3:30pm)')">
                    Duty 100 (6am-3:30pm)
                </div>
                <div class="duty-option" onclick="selectDuty('200', 'Duty 200 (7:30am-5pm)')">
                    Duty 200 (7:30am-5pm)
                </div>
                <div class="duty-option" onclick="selectDuty('400', 'Duty 400 (12:30pm-10pm)')">
                    Duty 400 (12:30pm-10pm)
                </div>
                <div class="duty-option" onclick="selectDuty('500', 'Duty 500 (2:45pm-12:15am)')">
                    Duty 500 (2:45pm-12:15am)
                </div>
                <div class="duty-option" onclick="selectDuty('xops', 'XOps')">
                    XOps
                </div>
                <div id="password-section" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Password:</label>
                        <input type="password" class="form-input" id="duty-password" placeholder="Enter password">
                    </div>
                    <div class="modal-actions">
                        <button class="modal-button cancel" onclick="closeDutyModal()">Cancel</button>
                        <button class="modal-button confirm" onclick="confirmDuty()">Confirm</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supervisor Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Supervisor Login</h2>
                <button class="close-button" onclick="closeLoginModal()">&times;</button>
            </div>
            <form class="modal-form" onsubmit="loginSupervisor(event)">
                <div class="form-group">
                    <label class="form-label">Supervisor ID:</label>
                    <select class="form-select" id="supervisorId" required>
                        <option value="">Select Supervisor</option>
                        <option value="alex_woodcock">Alex Woodcock</option>
                        <option value="andrew_cowley">Andrew Cowley</option>
                        <option value="anthony_gair">Anthony Gair</option>
                        <option value="claire_fiddler">Claire Fiddler</option>
                        <option value="david_hall">David Hall</option>
                        <option value="james_daglish">James Daglish</option>
                        <option value="john_paterson">John Paterson</option>
                        <option value="simon_glass">Simon Glass</option>
                        <option value="barry_perryman">Barry Perryman (Service Delivery Controller - Line Manager)</option>
                    </select>
                </div>
                <div class="form-group" id="password-group" style="display: none;">
                    <label class="form-label">Password:</label>
                    <input type="password" class="form-input" id="supervisorPassword" placeholder="Enter password">
                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Required for Line Manager access</div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-button cancel" onclick="closeLoginModal()">Cancel</button>
                    <button type="submit" class="modal-button confirm">Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supervisor Duty Selection Modal -->
    <div id="supervisorDutyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Select Your Duty</h2>
                <button class="close-button" onclick="closeSupervisorDutyModal()">&times;</button>
            </div>
            <div class="modal-form">
                <div style="margin-bottom: 20px; padding: 16px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <i class="fas fa-user-shield" style="color: var(--accent-blue);"></i>
                        <span style="font-weight: 600; color: var(--text-bright);" id="logged-supervisor-name">-</span>
                    </div>
                    <div style="font-size: 12px; color: var(--text-muted);" id="logged-supervisor-role">-</div>
                </div>
                <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 14px;">Please select which duty you are performing today:</p>
                <div class="duty-option" onclick="selectSupervisorDuty('100', 'Duty 100 (6am-3:30pm)')">
                    Duty 100 (6am-3:30pm)
                </div>
                <div class="duty-option" onclick="selectSupervisorDuty('200', 'Duty 200 (7:30am-5pm)')">
                    Duty 200 (7:30am-5pm)
                </div>
                <div class="duty-option" onclick="selectSupervisorDuty('400', 'Duty 400 (12:30pm-10pm)')">
                    Duty 400 (12:30pm-10pm)
                </div>
                <div class="duty-option" onclick="selectSupervisorDuty('500', 'Duty 500 (2:45pm-12:15am)')">
                    Duty 500 (2:45pm-12:15am)
                </div>
                <div class="duty-option" onclick="selectSupervisorDuty('xops', 'XOps')">
                    XOps
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Dismissal Modal -->
    <div id="dismissModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Dismiss Alert</h2>
                <button class="close-button" onclick="closeDismissModal()">&times;</button>
            </div>
            <form class="modal-form" onsubmit="confirmDismissal(event)">
                <div class="form-group">
                    <label class="form-label">Reason for Dismissal:</label>
                    <select class="form-select" id="dismissReason" required>
                        <option value="">Select reason</option>
                        <option value="false_alarm">False Alarm</option>
                        <option value="resolved">Issue Resolved</option>
                        <option value="duplicate">Duplicate Alert</option>
                        <option value="maintenance">Planned Maintenance</option>
                        <option value="low_impact">Low Impact</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Notes (Optional):</label>
                    <textarea class="form-textarea" id="dismissNotes" placeholder="Add any additional context..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-button cancel" onclick="closeDismissModal()">Cancel</button>
                    <button type="submit" class="modal-button confirm">Dismiss Alert</button>
                </div>
            </form>
        </div>
    </div>
    
// --- Supervisor Session Enforcement (MANDATORY) ---
function requireSupervisorSession() {
    if (!supervisorSession) {
        alert("Please log in as a supervisor to use this feature.");
        showLoginModal();
        return false;
    }
    return true;
}

    <script>
        // Global variables
        const API_BASE_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3001'
            : 'https://go-barry.onrender.com';

        let currentAlerts = [];
        let filteredAlerts = [];
        let supervisorSession = null;
        let currentDismissingAlert = null;
        let selectedDutyData = null;
        let currentDuty = null;
        let alertIndex = 0;
        let alertCycleTimer = null;
        let refreshTimer = null;
        let pendingSupervisorData = null;
        let loggedInSupervisors = []; // Track all logged-in supervisors

        // Supervisor definitions
        const supervisors = {
            'alex_woodcock': { name: 'Alex Woodcock', role: 'Supervisor', shift: 'Variable', requiresPassword: false },
            'andrew_cowley': { name: 'Andrew Cowley', role: 'Supervisor', shift: 'Variable', requiresPassword: false },
            'anthony_gair': { name: 'Anthony Gair', role: 'Supervisor', shift: 'Variable', requiresPassword: false },
            'claire_fiddler': { name: 'Claire Fiddler', role: 'Supervisor', shift: 'Variable', requiresPassword: false },
            'david_hall': { name: 'David Hall', role: 'Supervisor', shift: 'Variable', requiresPassword: false },
            'james_daglish': { name: 'James Daglish', role: 'Supervisor', shift: 'Variable', requiresPassword: false },
            'john_paterson': { name: 'John Paterson', role: 'Supervisor', shift: 'Variable', requiresPassword: false },
            'simon_glass': { name: 'Simon Glass', role: 'Supervisor', shift: 'Variable', requiresPassword: false },
            'barry_perryman': { name: 'Barry Perryman', role: 'Service Delivery Controller - Line Manager', shift: 'Management', requiresPassword: true, password: 'Barry123', isAdmin: true }
        };

        // Tab Management
        function switchTab(tabName) {
            // Update nav buttons
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.closest('.nav-tab').classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Initialize tab-specific content
            if (tabName === 'alerts') {
                renderAlertsGrid();
            } else if (tabName === 'maps') {
                updateMapMarkers();
            }
        }

        // Duty Management
        function showDutyModal() {
            document.getElementById('dutyModal').style.display = 'block';
        }

        function closeDutyModal() {
            document.getElementById('dutyModal').style.display = 'none';
            document.getElementById('password-section').style.display = 'none';
            selectedDutyData = null;
        }

        function selectDuty(id, name, requiresPassword = false) {
            // Remove previous selection
            document.querySelectorAll('.duty-option').forEach(opt => opt.classList.remove('selected'));
            
            // Select current option
            event.target.classList.add('selected');
            
            selectedDutyData = { id, name, requiresPassword };
            
            if (requiresPassword) {
                document.getElementById('password-section').style.display = 'block';
            } else {
                confirmDuty();
            }
        }

        function confirmDuty() {
            if (!selectedDutyData) return;
            
            if (selectedDutyData.requiresPassword) {
                const password = document.getElementById('duty-password').value;
                if (!password) {
                    alert('Please enter the password');
                    return;
                }
                if (password !== 'Barry123') {
                    alert('Incorrect password');
                    return;
                }
            }
            
            currentDuty = selectedDutyData;
            updateDutyDisplay();
            closeDutyModal();
        }

        function updateDutyDisplay() {
            if (currentDuty) {
                document.getElementById('duty-info').style.display = 'block';
                document.getElementById('duty-name').textContent = currentDuty.name;
            } else {
                document.getElementById('duty-info').style.display = 'none';
            }
        }

        // Supervisor Authentication
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
            // Reset form
            document.getElementById('supervisorId').value = '';
            document.getElementById('supervisorPassword').value = '';
            document.getElementById('password-group').style.display = 'none';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        // Handle supervisor selection change to show/hide password field
        document.addEventListener('DOMContentLoaded', function() {
document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.addEventListener('click', function(event) {
        if (!requireSupervisorSession()) {
            event.preventDefault();
            return false;
        }
    });
});
            const supervisorSelect = document.getElementById('supervisorId');
            if (supervisorSelect) {
                supervisorSelect.addEventListener('change', function() {
                    const selectedSupervisor = supervisors[this.value];
                    const passwordGroup = document.getElementById('password-group');
                    
                    if (selectedSupervisor && selectedSupervisor.requiresPassword) {
                        passwordGroup.style.display = 'block';
                    } else {
                        passwordGroup.style.display = 'none';
                    }
                });
            }
        });

        async function loginSupervisor(event) {
            event.preventDefault();
            
            const supervisorId = document.getElementById('supervisorId').value;
            const password = document.getElementById('supervisorPassword').value;
            
            if (!supervisorId) {
                alert('Please select a supervisor.');
                return;
            }
            
            const supervisorData = supervisors[supervisorId];
            if (!supervisorData) {
                alert('Invalid supervisor selection.');
                return;
            }
            
            // Check password for Barry Perryman
            if (supervisorData.requiresPassword) {
                if (!password || password !== supervisorData.password) {
                    alert('Incorrect password for Line Manager access.');
                    return;
                }
            }
            
            // Store supervisor data for duty selection
            pendingSupervisorData = {
                id: supervisorId,
                name: supervisorData.name,
                role: supervisorData.role,
                shift: supervisorData.shift,
                isAdmin: supervisorData.isAdmin || false
            };
            
            // Close login modal and show duty selection
            closeLoginModal();
            showSupervisorDutyModal();
        }

        // Supervisor Duty Selection Modal
        function showSupervisorDutyModal() {
            if (!pendingSupervisorData) return;
            
            document.getElementById('logged-supervisor-name').textContent = pendingSupervisorData.name;
            document.getElementById('logged-supervisor-role').textContent = pendingSupervisorData.role;
            document.getElementById('supervisorDutyModal').style.display = 'block';
        }

        function closeSupervisorDutyModal() {
            document.getElementById('supervisorDutyModal').style.display = 'none';
            pendingSupervisorData = null;
        }

        function selectSupervisorDuty(dutyId, dutyName) {
            if (!pendingSupervisorData) return;
            
            // Create supervisor session
            supervisorSession = {
                sessionId: 'session_' + Date.now(),
                supervisor: {
                    id: pendingSupervisorData.id,
                    name: pendingSupervisorData.name,
                    role: pendingSupervisorData.role,
                    shift: pendingSupervisorData.shift,
                    isAdmin: pendingSupervisorData.isAdmin,
                    duty: { id: dutyId, name: dutyName }
                }
            };
            
            // Set current duty
            currentDuty = { id: dutyId, name: dutyName };
            
            // Add to logged-in supervisors list
            const loggedInSupervisor = {
                id: pendingSupervisorData.id,
                name: pendingSupervisorData.name,
                duty: dutyName,
                loginTime: new Date(),
                sessionId: supervisorSession.sessionId
            };
            
            // Remove any existing entry for this supervisor and add new one
            loggedInSupervisors = loggedInSupervisors.filter(s => s.id !== pendingSupervisorData.id);
            loggedInSupervisors.push(loggedInSupervisor);
            
            // Update UI
            updateSupervisorUI();
            updateDutyDisplay();
            updateLoggedInSupervisorsDisplay();
            closeSupervisorDutyModal();
            
            // Load supervisor activity if admin
            if (supervisorSession.supervisor.isAdmin) {
                loadSupervisorActivity();
            }
            
            console.log('✅ Supervisor logged in:', supervisorSession.supervisor.name, 'Duty:', dutyName);
        }

        function updateLoggedInSupervisorsDisplay() {
            const container = document.getElementById('logged-supervisors');
            
            if (loggedInSupervisors.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No supervisors logged in</p>';
                return;
            }
            
            const supervisorsHtml = loggedInSupervisors.map(supervisor => {
                const loginTime = supervisor.loginTime.toLocaleTimeString('en-GB', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                return `
                    <div style="margin-bottom: 12px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-bright); font-size: 13px;">${supervisor.name}</div>
                                <div style="font-size: 11px; color: var(--text-muted);">${supervisor.duty}</div>
                                <div style="font-size: 10px; color: var(--text-muted);">Logged in: ${loginTime}</div>
                            </div>
                            <div style="width: 8px; height: 8px; background: var(--status-success); border-radius: 50%;"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = supervisorsHtml;
        }

        function updateSupervisorUI() {
            if (supervisorSession) {
                document.getElementById('supervisor-login').style.display = 'none';
                document.getElementById('supervisor-info').style.display = 'block';
                document.getElementById('supervisor-actions').style.display = 'block';
                
                document.getElementById('supervisor-name').textContent = supervisorSession.supervisor.name;
                document.getElementById('supervisor-role').textContent = supervisorSession.supervisor.role;
                
                updateDismissButtons();
                
                // Update supervisor actions count for admin
                if (supervisorSession.supervisor.isAdmin) {
                    document.getElementById('supervisor-actions-count').textContent = '∞';
                }
            } else {
                document.getElementById('supervisor-login').style.display = 'block';
                document.getElementById('supervisor-info').style.display = 'none';
                document.getElementById('supervisor-actions').style.display = 'none';
                
                updateDismissButtons();
            }
            updateSupervisorIndicator();
        }

        // Supervisor Indicator
        function updateSupervisorIndicator() {
            const ind = document.getElementById('supervisor-indicator');
            if (supervisorSession && supervisorSession.supervisor) {
                ind.innerHTML = '<div style="background:rgba(59,130,246,0.95);color:white;padding:8px 16px;border-radius:16px;box-shadow:0 2px 10px rgba(59,130,246,0.25);font-size:13px;font-weight:600;letter-spacing:0.5px;">' +
                    'Supervisor: ' + supervisorSession.supervisor.name +
                    ' <span style="font-weight:400;opacity:0.7;">(' + supervisorSession.supervisor.role + ')</span>' +
                    '</div>';
            } else {
                ind.innerHTML = '';
            }
        }

        function updateDismissButtons() {
            // Update .dismiss-button, .acknowledge-button, .map-button to wrap onclick with requireSupervisorSession
            ['.dismiss-button', '.acknowledge-button', '.map-button'].forEach(selector => {
                document.querySelectorAll(selector).forEach(button => {
                    // Only update if not already wrapped
                    if (button.hasAttribute('data-supervisor-handler')) return;
                    let origOnclick = button.getAttribute('onclick');
                    if (origOnclick && !origOnclick.trim().startsWith('if(requireSupervisorSession())')) {
                        // Remove any previous wrapping for safety (idempotent)
                        origOnclick = origOnclick.replace(/^if\(requireSupervisorSession\(\)\)\s*/, '');
                        button.setAttribute('onclick', `if(requireSupervisorSession()) ${origOnclick}`);
                        button.setAttribute('data-supervisor-handler', '1');
                    }
                });
            });
            // Also update enabled/disabled state for dismiss buttons
            const dismissButtons = document.querySelectorAll('.dismiss-button');
            dismissButtons.forEach(button => {
                button.disabled = !supervisorSession;
                if (supervisorSession) {
                    button.style.background = 'rgba(239, 68, 68, 0.8)';
                    button.style.cursor = 'pointer';
                } else {
                    button.style.background = 'rgba(107, 114, 128, 0.5)';
                    button.style.cursor = 'not-allowed';
                }
            });
        }

        async function logoutSupervisor() {
            if (!supervisorSession) return;
            
            try {
                // Remove from logged-in supervisors list
                loggedInSupervisors = loggedInSupervisors.filter(s => s.sessionId !== supervisorSession.sessionId);
                
                // Only call API logout if we have a real session
                if (supervisorSession.sessionId.startsWith('session_')) {
                    // Local session - just clear
                    console.log('✅ Local supervisor session cleared');
                } else {
                    // API session - call logout endpoint
                    await fetch(`${API_BASE_URL}/api/supervisor/auth/logout`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sessionId: supervisorSession.sessionId })
                    });
                }
                
                supervisorSession = null;
                currentDuty = null;
                pendingSupervisorData = null;
                
                updateSupervisorUI();
                updateDutyDisplay();
                updateLoggedInSupervisorsDisplay();
                
                document.getElementById('supervisor-activity').innerHTML = 
                    '<p style="color: var(--text-muted); text-align: center; padding: 20px;">Log in to view supervisor activity</p>';
                
                // Reset supervisor actions count
                document.getElementById('supervisor-actions-count').textContent = '0';
                
                console.log('✅ Supervisor logged out');
            } catch (error) {
                console.error('❌ Logout error:', error);
                // Clear session anyway
                supervisorSession = null;
                currentDuty = null;
                loggedInSupervisors = loggedInSupervisors.filter(s => s.sessionId !== (supervisorSession?.sessionId));
                updateSupervisorUI();
                updateDutyDisplay();
                updateLoggedInSupervisorsDisplay();
            }
        }

        async function loadSupervisorActivity() {
            if (!supervisorSession) return;
            
            try {
                const response = await fetch(
                    `${API_BASE_URL}/api/supervisor/supervisors/${supervisorSession.supervisor.id}/activity?limit=10`
                );
                const result = await response.json();
                
                if (result.success && result.activity.length > 0) {
                    const activityHTML = result.activity.map(activity => `
                        <div style="margin-bottom: 12px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                            <div style="font-weight: 600; color: #e2e8f0; font-size: 12px;">${activity.type.toUpperCase()}</div>
                            <div style="font-size: 11px; color: #94a3b8;">${activity.details}</div>
                            <div style="font-size: 10px; color: #64748b;">${new Date(activity.timestamp).toLocaleString()}</div>
                        </div>
                    `).join('');
                    
                    document.getElementById('supervisor-activity').innerHTML = activityHTML;
                } else {
                    document.getElementById('supervisor-activity').innerHTML = 
                        '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No recent activity</p>';
                }
            } catch (error) {
                console.error('❌ Failed to load supervisor activity:', error);
            }
        }

        // Alert Dismissal
        function showDismissModal(alertId) {
            if (!supervisorSession) {
                alert('Please log in as a supervisor to dismiss alerts.');
                return;
            }
            
            currentDismissingAlert = alertId;
            document.getElementById('dismissModal').style.display = 'block';
        }

        function closeDismissModal() {
            document.getElementById('dismissModal').style.display = 'none';
            currentDismissingAlert = null;
            // Reset form
            document.getElementById('dismissReason').value = '';
            document.getElementById('dismissNotes').value = '';
        }

        async function confirmDismissal(event) {
            event.preventDefault();
            
            if (!currentDismissingAlert || !supervisorSession) return;
            
            const reason = document.getElementById('dismissReason').value;
            const notes = document.getElementById('dismissNotes').value;
            
            if (!reason) {
                alert('Please select a reason for dismissal.');
                return;
            }
            
            try {
                // For now, simulate dismissal since we don't have full API integration
                console.log('✅ Alert dismissed:', currentDismissingAlert, 'by', supervisorSession.supervisor.name);
                console.log('Reason:', reason, 'Notes:', notes);
                
                // Remove alert from current alerts
                currentAlerts = currentAlerts.filter(alert => alert.id !== currentDismissingAlert);
                filteredAlerts = filteredAlerts.filter(alert => alert.id !== currentDismissingAlert);
                
                // Update displays
                updateAlertsDisplay();
                updateAnalytics();
                
                // Log supervisor activity
                if (supervisorSession.supervisor.isAdmin) {
                    const activityHtml = `
                        <div style="margin-bottom: 12px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                            <div style="font-weight: 600; color: #e2e8f0; font-size: 12px;">ALERT DISMISSED</div>
                            <div style="font-size: 11px; color: #94a3b8;">Alert ${currentDismissingAlert} dismissed by ${supervisorSession.supervisor.name}</div>
                            <div style="font-size: 10px; color: #64748b;">${new Date().toLocaleString()}</div>
                        </div>
                    `;
                    
                    const activityContainer = document.getElementById('supervisor-activity');
                    if (activityContainer && !activityContainer.textContent.includes('Log in to view')) {
                        activityContainer.innerHTML = activityHtml + activityContainer.innerHTML;
                    }
                }
                
                closeDismissModal();
                alert(`Alert ${currentDismissingAlert} has been dismissed by ${supervisorSession.supervisor.name}`);
                
            } catch (error) {
                console.error('❌ Dismissal error:', error);
                alert('Failed to dismiss alert. Please try again.');
            }
        }

        function acknowledgeAlert(alertId) {
            if (!supervisorSession) {
                alert('Please log in as a supervisor to acknowledge alerts.');
                return;
            }
            
            console.log('✅ Alert acknowledged:', alertId, 'by', supervisorSession.supervisor.name);
            
            // Log supervisor activity for admin
            if (supervisorSession.supervisor.isAdmin) {
                const activityHtml = `
                    <div style="margin-bottom: 12px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                        <div style="font-weight: 600; color: #e2e8f0; font-size: 12px;">ALERT ACKNOWLEDGED</div>
                        <div style="font-size: 11px; color: #94a3b8;">Alert ${alertId} acknowledged by ${supervisorSession.supervisor.name}</div>
                        <div style="font-size: 10px; color: #64748b;">${new Date().toLocaleString()}</div>
                    </div>
                `;
                
                const activityContainer = document.getElementById('supervisor-activity');
                if (activityContainer && !activityContainer.textContent.includes('Log in to view')) {
                    activityContainer.innerHTML = activityHtml + activityContainer.innerHTML;
                }
            }
            
            alert(`Alert ${alertId} has been acknowledged by ${supervisorSession.supervisor.name}`);
        }

        // Open alert location in map
        async function openAlertMap(alertId, location) {
            console.log(`🗺️ Opening map for alert: ${alertId} at location: ${location}`);
            
            try {
                // Find the alert in currentAlerts array
                const alert = currentAlerts.find(a => a.id === alertId);
                let latitude, longitude;
                
                // Check if alert has coordinates
                if (alert && alert.coordinates) {
                    if (Array.isArray(alert.coordinates) && alert.coordinates.length >= 2) {
                        [latitude, longitude] = alert.coordinates;
                    } else if (alert.coordinates.lat && alert.coordinates.lng) {
                        latitude = alert.coordinates.lat;
                        longitude = alert.coordinates.lng;
                    }
                }
                
                // If no coordinates but we have a location, try to geocode
                if ((!latitude || !longitude) && location && location !== 'Location not specified') {
                    // For browser app, we'll use a simpler approach and search by location name
                    const searchQuery = encodeURIComponent(location + ', North East England, UK');
                    const googleMapsUrl = `https://www.google.com/maps/search/${searchQuery}`;
                    
                    console.log(`🗺️ Opening Google Maps search for: ${location}`);
                    window.open(googleMapsUrl, '_blank');
                    return;
                }
                
                // If we have coordinates, use them
                if (latitude && longitude) {
                    const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}&zoom=15`;
                    console.log(`🗺️ Opening Google Maps at coordinates: ${latitude}, ${longitude}`);
                    window.open(googleMapsUrl, '_blank');
                } else {
                    // Fallback to general North East England map
                    const fallbackUrl = 'https://www.google.com/maps/@54.9783,-1.6178,11z';
                    console.log(`⚠️ No coordinates available for alert ${alertId}, opening North East England map`);
                    window.open(fallbackUrl, '_blank');
                    
                    // Show user-friendly message
                    alert('Opening map of North East England. Specific location coordinates are not available for this alert.');
                }
                
            } catch (error) {
                console.error('❌ Error opening map:', error);
                alert('Unable to open map. Please try again.');
            }
        }

        // Alert Management
        async function fetchAlerts() {
            try {
                console.log('🚀 Fetching alerts from:', API_BASE_URL);
                const response = await fetch(`${API_BASE_URL}/api/alerts-enhanced`);
                const data = await response.json();
                
                if (data.success && data.alerts) {
                    currentAlerts = data.alerts;
                    filteredAlerts = [...currentAlerts];
                    updateAlertsDisplay();
                    updateAnalytics();
                    
                    const lastUpdate = document.getElementById('last-update');
                    lastUpdate.textContent = `Last Update: ${new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })}`;
                    
                    document.getElementById('last-refresh-time').textContent = new Date().toLocaleString();
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                console.error('❌ Error fetching alerts:', error);
                showErrorState();
            }
        }

        function updateAlertsDisplay() {
            updateDashboardAlerts();
            renderAlertsGrid();
            updateMapMarkers();
        }

        function updateDashboardAlerts() {
            const alertsContainer = document.getElementById('dashboard-alerts-container');
            const alertCount = document.getElementById('dashboard-alert-count');
            
            alertCount.textContent = currentAlerts.length;
            
            if (currentAlerts.length === 0) {
                alertsContainer.innerHTML = `
                    <div class="no-alerts">
                        <i class="fas fa-shield-check"></i>
                        <h3>All Systems Clear</h3>
                        <p>No active traffic alerts detected</p>
                    </div>
                `;
                clearAlertCycle();
                return;
            }
            
            alertIndex = 0;
            renderCurrentAlert();
            startAlertCycle();
        }

        function renderCurrentAlert() {
            const alertsContainer = document.getElementById('dashboard-alerts-container');
            if (!currentAlerts || currentAlerts.length === 0) return;
            
            const alert = currentAlerts[alertIndex % currentAlerts.length];
            alertsContainer.innerHTML = createAlertCard(alert);
            updateDismissButtons();
        }

        function startAlertCycle() {
            clearAlertCycle();
            if (!currentAlerts || currentAlerts.length <= 1) return;
            
            alertCycleTimer = setInterval(() => {
                alertIndex = (alertIndex + 1) % currentAlerts.length;
                renderCurrentAlert();
            }, 15000);
        }

        function clearAlertCycle() {
            if (alertCycleTimer) {
                clearInterval(alertCycleTimer);
                alertCycleTimer = null;
            }
        }

        function createAlertCard(alert) {
            const statusClass = alert.status === 'red' ? 'critical' : alert.status === 'amber' ? 'warning' : 'success';
            
            const routeBadges = alert.affectsRoutes && alert.affectsRoutes.length > 0
                ? alert.affectsRoutes.map(route => `<span class="route-badge">${route}</span>`).join('')
                : '<span class="route-badge" style="opacity: 0.6;">No routes identified</span>';
            
            const dismissButton = supervisorSession ? 
                `<button class="dismiss-button" onclick="showDismissModal('${alert.id}')">
                    <i class="fas fa-times"></i> Dismiss
                </button>` : 
                `<button class="dismiss-button" disabled>
                    <i class="fas fa-lock"></i> Login Required
                </button>`;
            
            // Map button - always available
            const mapButton = `<button class="map-button" onclick="openAlertMap('${alert.id}', '${(alert.location || '').replace(/'/g, '\\\'')}')">
                <i class="fas fa-map-marked-alt"></i> Map
            </button>`;
            
            return `
                <div class="alert-card ${statusClass}">
                    <div class="alert-header">
                        <div class="alert-title">${alert.title || 'Traffic Alert'}</div>
                        <div class="alert-actions">
                            ${mapButton}
                            ${dismissButton}
                            <button class="acknowledge-button" onclick="acknowledgeAlert('${alert.id}')">
                                <i class="fas fa-check"></i> Acknowledge
                            </button>
                        </div>
                    </div>
                    <div class="alert-location">
                        <i class="fas fa-map-marker-alt"></i>
                        ${alert.location || 'Location not specified'}
                    </div>
                    <div class="alert-description">${alert.description || 'No description available'}</div>
                    <div class="route-badges">${routeBadges}</div>
                    <div class="alert-meta">
                        <div>Source: ${alert.dataSource || alert.source}</div>
                        <div>${alert.startDate ? new Date(alert.startDate).toLocaleString('en-GB', { 
                            month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                        }) : 'Time unknown'}</div>
                    </div>
                </div>
            `;
        }

        function renderAlertsGrid() {
            const alertsGrid = document.getElementById('alerts-grid');
            
            if (filteredAlerts.length === 0) {
                alertsGrid.innerHTML = `
                    <div class="no-alerts" style="grid-column: 1 / -1;">
                        <i class="fas fa-search"></i>
                        <h3>No alerts found</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
                return;
            }
            
            alertsGrid.innerHTML = filteredAlerts.map(alert => createAlertCard(alert)).join('');
            updateDismissButtons();
        }

        function filterAlerts(type) {
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (type === 'all') {
                filteredAlerts = [...currentAlerts];
            } else {
                filteredAlerts = currentAlerts.filter(alert => alert.type === type);
            }
            
            renderAlertsGrid();
        }

        function updateAnalytics() {
            const activeAlerts = currentAlerts.filter(a => a.status === 'red').length;
            const affectedRoutes = new Set(currentAlerts.flatMap(a => a.affectsRoutes || [])).size;
            
            document.getElementById('active-alerts-count').textContent = activeAlerts;
            document.getElementById('affected-routes-count').textContent = affectedRoutes;
            document.getElementById('cached-alerts-count').textContent = currentAlerts.length;
            document.getElementById('resolved-count').textContent = Math.floor(currentAlerts.length * 0.3);
            
            // Update statistics
            document.getElementById('stats-total').textContent = currentAlerts.length;
            document.getElementById('stats-active').textContent = activeAlerts;
            document.getElementById('stats-dismissed').textContent = Math.floor(currentAlerts.length * 0.2);
        }

        function showErrorState() {
            const alertsContainer = document.getElementById('dashboard-alerts-container');
            alertsContainer.innerHTML = `
                <div style="text-align: center; padding: 60px; color: var(--text-muted);">
                    <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 16px; color: var(--status-warning);"></i>
                    <h3>Connection Error</h3>
                    <p>Unable to fetch traffic alerts. Retrying...</p>
                </div>
            `;
        }

        // Map functions (placeholder)
        function filterMapAlerts(type) {
            document.querySelectorAll('#maps-tab .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            console.log('Map filter:', type);
        }

        function centerMap() {
            console.log('Centering map');
        }

        function updateMapMarkers() {
            document.getElementById('map-markers-count').textContent = currentAlerts.length;
        }

        // System functions
        async function refreshData() {
            console.log('🔄 Refreshing data...');
            await fetchAlerts();
        }

        async function testAPI() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/health`);
                const data = await response.json();
                alert(`API Test Result:\nStatus: ${data.status}\nVersion: ${data.version}\nCached Alerts: ${data.cachedAlerts || 0}`);
            } catch (error) {
                alert(`API Test Failed: ${error.message}`);
            }
        }

        function clearCache() {
            currentAlerts = [];
            filteredAlerts = [];
            updateAlertsDisplay();
            alert('Cache cleared');
        }

        // Search functionality
        document.getElementById('alert-search').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            if (!searchTerm) {
                filteredAlerts = [...currentAlerts];
            } else {
                filteredAlerts = currentAlerts.filter(alert => 
                    alert.title?.toLowerCase().includes(searchTerm) ||
                    alert.description?.toLowerCase().includes(searchTerm) ||
                    alert.location?.toLowerCase().includes(searchTerm) ||
                    alert.affectsRoutes?.some(route => route.toLowerCase().includes(searchTerm))
                );
            }
            renderAlertsGrid();
        });

        // Clock update
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-GB', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('clock').textContent = timeString;
        }

        // Initialization
        function init() {
            console.log('🚦 Go BARRY Browser App Initializing...');
            
            // Initialize clock
            updateClock();
            setInterval(updateClock, 1000);
            
            // Initialize system info
            document.getElementById('backend-url').textContent = API_BASE_URL;
            
            // Initialize logged-in supervisors display
            updateLoggedInSupervisorsDisplay();
            
            // Show duty modal if no duty selected
            if (!currentDuty) {
                setTimeout(() => showDutyModal(), 1000);
            }
            
            // Load initial data
            fetchAlerts();
            
            // Set up auto-refresh
            refreshTimer = setInterval(fetchAlerts, 30000); // 30 seconds
            
            // Initialize UI
            updateSupervisorUI();
            updateDutyDisplay();
            
            console.log('✅ Go BARRY Browser App Ready');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', init);
        
        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const modals = ['loginModal', 'dismissModal', 'dutyModal', 'supervisorDutyModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            if ((event.ctrlKey || event.metaKey) && event.key === 'r') {
                event.preventDefault();
                refreshData();
            }
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        });

        // Tab shortcuts
        document.addEventListener('keydown', (event) => {
            if (event.altKey) {
                switch(event.key) {
                    case '1': switchTab('dashboard'); break;
                    case '2': switchTab('alerts'); break;
                    case '3': switchTab('maps'); break;
                    case '4': switchTab('system'); break;
                    case '5': switchTab('settings'); break;
                }
            }
        });
    </script>
</body>
</html>